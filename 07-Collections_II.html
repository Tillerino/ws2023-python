<!doctype html>
<html lang="en">

    <head>
        <meta charset="utf-8">

        <title>07 - Collections II (Pythonkurs für Anfänger WS2023)</title>

        <meta name="apple-mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

        <meta name="viewport" content="width=device-width, initial-scale=1.0">

        <link rel="stylesheet" href="dist/reset.css">
        <link rel="stylesheet" href="dist/reveal.css">
        <link rel="stylesheet" href="dist/theme/white.css" id="theme">

        <!-- Theme used for syntax highlighting of code -->
        <link rel="stylesheet" href="thonny.css">

        <!-- Font awesome is required for the chalkboard plugin -->
        <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/js/all.min.js"></script>
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
        <!-- Custom controls plugin is used to for opening and closing annotation modes. -->
        <script src="https://cdn.jsdelivr.net/npm/reveal.js-plugins@4.2.5/customcontrols/plugin.js"></script>
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/reveal.js-plugins@4.2.5/customcontrols/style.css">
        <!-- Chalkboard plugin -->
        <script src="https://cdn.jsdelivr.net/npm/reveal.js-plugins@4.2.5/chalkboard/plugin.js"></script>
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/reveal.js-plugins@4.2.5/chalkboard/style.css">

        <script src="reconnecting-websocket.js"></script>
        <script src="ws.js"></script>

        <style>
            .reveal textarea, .reveal pre { font-size: 1em; }
            .reveal .slides { text-align: left; }
            :root { --r-heading-text-transform: none; --r-heading-font-weight: 200; }
            html.reveal-print .reveal .slides section.title, section.title { padding-top: 200px!important; }

            a.runCode { padding-left: 0.5em; padding-right: 0.5em; color: black; }
            a.runCode:hover { color: red; }
            .runCode::before { content: '➧' }

            p-out { padding-left: 0.2em; padding-right: 0.2em; font-family: monospace; background-color: #eee; white-space: pre-wrap; }
            p-out .error { color: #cc0000; }
            p-il { padding-left: 0.1em; padding-right: 0.1em; font-family: monospace; background-color: #eee; text-wrap: nowrap; }
            .no-background span[data-inline-python], .no-background .hljs { background: none; }

            textarea[is='highlighted-code'] { position:relative; top: .3em; }
            .reveal pre { box-shadow: .05em .05em 0.1em rgba(0, 0, 0, 0.15); }

            li { margin-top: .1em; margin-bottom: .1em }
            ul ul, ul ol, ol ul, ol ol { font-size: .85em; }

            .reveal table { margin: 0px; }
        </style>
    </head>

    <body>

        <div class="reveal">

            <div class="slides">
                <section data-background-image="titleslide16-9.svg" data-background-size="contain" class="title" style="font-size: 35px;">
                    <h1 style="font-size: 100px;">Pythonkurs für Anfänger</h1>

                    <h2 style="padding-top: 40px;">Einheit 07: Collections II</h2>

                    <a id="switch-to-interactive" style="visibility: hidden">Zu den interaktiven Folien</a>
                    <script>
                        let elem = document.getElementById("switch-to-interactive")
                        let file = window.location.pathname.substr(window.location.pathname.lastIndexOf('/'))
                        elem.href = "https://tillerino.github.io/ws2023-python" + file + "?noFragments&withControls"
                        if (new URLSearchParams(window.location.search).get('print-pdf') !== null) {
                            elem.style.visibility = "visible"
                        }
                    </script>

                    <div style="padding-top: 65px;">Tillmann Gaida</div>
                    <div style="padding-top: 20px;">Software and Computational System Lab</div>
                </section>

                <section style="font-size: 38px;">
                    <h1>Advent of Code</h1>
                    <ul>
                        <li>Jedes Jahr gibt es den <a href="https://adventofcode.com" target="_blank">Advent of Code</a>: einen Adventskalender an Programmieraufgaben.</li>
                        <li>Die erste Aufgabe gibt es am 1. Dezember und die letzte am 25. Dezember.</li>
                        <li>Die Aufgaben fangen einfach an und werden immer schwieriger.</li>
                        <li><a href="https://adventofcode.com/2023/leaderboard/private/view/2278782">Leaderboard</a>: <code>2278782-ab82d160</code><br>
                            ([Log in], [Leaderboard], [Private Leaderboard], code eingeben)</li>
                    </ul>
                    <br><br>
                    <iframe src="https://adventofcode.com" width="100%" height="200"></iframe>
                </section>

                <section style="font-size: 28px;">
                    <h1>(letzte) Übung</h1>
                </section>

                <section style="font-size: 32px;">
                    <h1>Werkzeuge</h1>
                    <div style="display: grid; column-gap: .5em; grid-template-columns: 60% 40%;">
                        <div style="border-right: solid 1px black; padding-bottom: .5em; padding-right: .5em;">
                            <h3>Syntax</h3>
                            `fun(x)`,
                            `x`,
                            `'abc'`,
                            `123`,
                            `=`,
                            `if`,
                            `elif`,
                            `else`,
                            `while`,
                            `continue`,
                            `break`,
                            `in`,
                            `for i in l`,
                            `[ a, b, c ]`,
                            `l[i]`,
                            `l[i:j]`,
                            `{ a: b, c: d }`
                            Einrückung
                            <ul>
                                <li>Operatoren:
                                    `+`,
                                    `-`,
                                    `*`,
                                    `/`,
                                    `//`,
                                    `%`,
                                    `**`,
                                    `==`,
                                    `!=`,
                                    `&lt;`,
                                    `&gt;`,
                                    `&lt;=`,
                                    `&gt;=`,
                                    `and`,
                                    `or`,
                                    `not`
                                </li>
                            </ul>
                            `def`,
                            `return`,
                            `fun(..., k=v)`
                        </div>
                        <div style="padding-bottom: .5em;">
                            <h3>Algorithmik:</h3>
                            Fallunterscheidung,
                            Laufvariable,
                            Iterieren (über Zeilen einer Datei)
                        </div>
                    </div>
                    <div style="display: grid; column-gap: .5em; grid-template-columns: 60% 40%; border-top: solid black 1px">
                        <div style="border-right: solid 1px black; padding-top: .5em; padding-right: .5em;">
                            <h3>Vokabular</h3>
                            `print`,
                            `input`,
                            `int`,
                            `str`,
                            `list`,
                            `len`,
                            `split`,
                            `open`,
                            `rstrip`,
                            `min`
                            `max`,
                            `sum`,
                            `append`,
                            `extend`,
                            `pop`,
                            `range`,
                            `items`
                        </div>
                        <div style="padding-top: .5em;">
                            <h3>Architektur</h3>
                            Funktionen
                        </div>
                    </div>
                </section>

                <section class="center" style="text-align: center;">Platz für Fragen</section>

                <section style="font-size: 35px;">
                    <h1>Heute</h1>
                    <ul>
                        <li>Tupel <br>```cols=25
                            t = (1, 2, 3)
                            t
                        ```</li>
                        <li class="fragment">Mengen <br>```cols=25
                            s = { 1, 2, 3, 2 }
                            s
                        ```</li>
                        <li class="fragment">Comprehensions <br>```cols=25
                            l = [ x * x for x in s ]
                            l
                        ```</li>
                        <li class="fragment">Übersicht</li>
                    </ul>
                </section>

                <!--  SECTION: TUPEL -->

                <section data-background-image="titleslide16-9.svg" data-background-size="contain" class="title">
                    <h3 style="margin-top: 200px">Tupel</h3>
                </section>

                <section style="font-size: 30px">
                    <h1>Tupel</h1>
                    <div style="display: grid; column-gap: 1em; grid-template-columns: 53% 43%">
                        <ul><li>Ein <em>Tupel</em> ist eine unveränderbare Liste. Es wird mit Klammern definiert und ist sonst ähnlich verwendbar:<br>```cols=22
                            t = (5, 6, 7, 8, 9)
                            t[1]
                        ```<br>```cols=22
                            t[1:3]
                        ```</li>
                        <li class="fragment">Versucht man ein Tupel zu verändern, gibt es einen Fehler:<br>```cols=22
                            t[1] = 1
                        ```</ul>
                        <ul><li class="fragment">Das gleiche gilt für die anderen modifizierenden Methoden wie `append` oder `pop`.</li>
                        </ul>
                    </div>
                </section>

                <section style="font-size: 30px">
                    <h1>Warum Tupel?</h1>
                    <div style="display: grid; column-gap: 1em; grid-template-columns: 48% 48%">
                        <div>1. Tupel verkörpern eine andere Idee als Listen.
                            <ul>
                                <li class="fragment">Listen werden üblicherweise für eine <em>variable</em> Anzahl von <em>gleichartigen</em> Elementen verwendet.<ul>
                                    <li>Die Anzahl der Elemente steht beim Programmieren noch nicht fest oder verändert sich im Laufe des Programms.</li>
                                    <li>Dies ist typischerweise eine Eingabe des Programms.</li></ul></li>
                                <li class="fragment">Tupel werden üblicherweise für eine <em>konstante</em> Anzahl von <em>ggf. verschiedenartigen</em> Elementen verwendet.<ul>
                                    <li>Die Anzahl der Elemente steht beim Programmieren schon fest.</li>
                                    <li>Die Komponenten eines Tupels sind unterschiedliche Eigenschaften desselben Objekts.</li></ul></li>

                            </ul>
                        </div>
                        <div class="fragment">
                            2. Tupel können gehasht werden.
                            <ul>
                                <li class="fragment">Da sie nicht veränderbar sind, implementiert Python eine Hashfunktion für Tupel.</li>
                                <li class="fragment">Sie können daher z.B. als Schlüssel in einem Dictionary verwendet werden:<br>```cols=30
                                    d = { (1, 'a'): [ 1, 2, 3 ] }
                                    d[(1, 'a')]
                                ```</li>
                            </ul>
                        </div>
                    </div>
                </section>

                <section style="font-size: 29px">
                    <h1>Entpacken</h1>
                    <div style="display: grid; column-gap: 1em; grid-template-columns: 48% 48%">
                        <ul>
                            <li>Tupel können auch auf der linken Seite einer Zuweisung stehen. In diesem Fall werden die werte <em>entpackt</em><br>```cols=15
                                t = (1, 2, 3)
                                (a, b, c) = t
                                a
                            ```<br>```cols=15
                                b
                            ```<br>```cols=15
                                c
                            ```</li>
                            <li class="fragment">Zusätzlich können die Klammern sowohl beim Erstellen als auch beim Entpacken eines Tupels weggelassen werden:<br>```cols=15
                                t = 1, 2, 3
                                a, b, c = t
                                a
                            ```</li>
                        </ul>
                        <ul>
                            <li class="fragment">Tatsächlich kann eine Funktion nicht mehrere Werte zurückgeben. Mit Tupeln sieht es nur so aus:<br>```cols=20
                                def f():
                                    return 1, 2
                                a, b = f()
                                b
                            ```</li>
                            <li class="fragment">Das Gleiche gilt für das Iterieren über Schlüssel-Wert-Paare eines Dictionarys. Hier werden tatsächlich Tupel erstellt und entpackt:<br>```cols=25
                                d = { 'a': 1, 'b': 2 }
                                for k, v in d.items():
                                    print(k, v)
                            ```</li>
                        </ul>
                    </div>
                </section>

                <section class="center" style="text-align: center;">(Mehr in der Übersicht)<br><br>Platz für Fragen</section>

                <!-- SECTION: MENGEN -->

                <section data-background-image="titleslide16-9.svg" data-background-size="contain" class="title">
                    <h3 style="margin-top: 200px">Mengen</h3>
                </section>

                <section style="font-size: 32px">
                    <h1>Mengen</h1>
                    <ul>
                        <li>Eine <em>Menge</em> ist eine Sammlung von Elementen, in der jedes Element nur einmal vorkommt.
                            Sie wird mit geschweiften Klammern definiert:<br>```cols=20
                            s = { 1, 2, 3, 2 }
                            s
                        ```</li>
                        <li class="fragment">Eine Menge wendet wie ein Dictionary eine Hashfunktion auf ihre Elemente an.
                            Dies bedeutet, dass das Prüfen, ob ein Element in einer Menge vorkommt, sehr schnell geht:<br>```cols=20
                            2 in s
                        ```</li>
                        <li class="fragment">Dies bedeutet aber auch, dass es die gleichen Einschränkungen wie bei Dictionary-Schlüsseln gibt:<br>```cols=25
                            s = { [1, 2], ['x'] }
                        ```</li>
                        </li>
                    </ul>
                </section>

                <section style="font-size: 32px">
                    <h1>Modifikation</h1>
                    <ul>
                        <li>Wie bei Listen gibt es Methoden, um Mengen zu verändern. Die Methoden heißen etwas anders:<br>```cols=20
                            s = { 1, 2, 3 }
                            s.add(4)
                            s
                        ```</li>
                        <li class="fragment">```cols=20
                            s.update({ 5, 6 })
                            s
                        ```<br>
                        `update` akzeptiert auch Listen oder Tupel.</li>
                        <li class="fragment">```cols=20
                            s.remove(2)
                            s
                        ```</li>
                    </ul>
                </section>

                <section class="center" style="text-align: center;">(Mehr in der Übersicht)<br><br>Platz für Fragen</section>

                <!-- SECTION: COMPREHENSIONS -->

                <section data-background-image="titleslide16-9.svg" data-background-size="contain" class="title">
                    <h3 style="margin-top: 200px">Comprehensions</h3>
                </section>

                <section style="font-size: 35px">
                    <h1>Comprehensions</h1>
                    <div style="display: grid; column-gap: 1em; grid-template-columns: 45% 51%">
                        <ul>
                            <li>
                                Folgenden Code werden Sie häufig sehen:<br>
                                ```cols=23 br
                                l1 = [ 1, 2, 3, 4, 5 ]
                                l2 = []
                                for x in l1:
                                    l2.append(x*x)
                                l2
                                ```
                            </li>
                        </ul>
                        <ul>
                            <li class="fragment">
                                Dieser ist mit einer <em>List Comprehension</em> wesentlich kompakter:<br>
                                ```cols=27 br
                                l2 = [ x*x for x in l1 ]
                                l2
                                ```
                            </li>
                        </ul>
                    </div>
                </section>

                <section style="font-size: 33px">
                    <h1>Filter</h1>
                    <div style="display: grid; column-gap: 1em; grid-template-columns: 42% 54%">
                        <ul>
                            <li class="fragment">
                                Schleife:<br>
                                ```cols=23 br
                                l1 = [ 3, 2, 4, 2, 1 ]
                                l2 = []
                                for x in l1:
                                    if x > 1:
                                        l2.append(x*x)
                                l2
                                ```
                            </li>
                        </ul>
                        <ul>
                            <li>So wie in einer Schleife kann man auch in einer List Comprehension filtern.</li>
                            <li class="fragment">
                                Comprehension:<br>
                                ```cols=31 br
                                l2 = [x*x for x in l1 if x > 1]
                                l2
                                ```
                            </li>
                        </ul>
                    </div>
                </section>

                <section style="font-size: 30px">
                    <h1>Tupel, Mengen, Dictionaries</h1>
                    <ul>
                        <li>Es gibt für alle vorgestellten Collections Comprehensions.
                            Listen:<br>
                            ```cols=45
                            l1 = [ 3, 2, 4, 2, 1 ]
                            l2 = [ x*x for x in l1 if x > 1 ]
                            l2
                            ```
                        </li>
                        <li class="fragment">Tupel:<br>
                            ```cols=45
                            t = tuple(x*x for x in l1 if x > 1)
                            t
                            ```
                        </li>
                        <li class="fragment">Mengen:<br>
                            ```cols=45
                            s = { x*x for x in l1 if x > 1 }
                            s
                            ```
                        </li>
                        <li class="fragment">Dictionaries:<br>
                            ```cols=45
                            d = { x: x*x for x in l1 if x > 1 }
                            d
                            ```
                        </li>
                    </ul>
                </section>

                <section style="font-size: 29px">
                    <h1>Vertiefung: Generatorausdrücke</h1>
                    <ul>
                        <li>Warum mussten wir eigentlich `tuple(...)` schreiben und nicht einfach nur `(...)`?</li>
                        <li class="fragment">```cols=30 br
                            l = [ 3, 2, 4, 2, 1 ]
                            t = (x*x for x in l if x > 1)
                            t
                        ```</li>
                        <li class="fragment">
                            Die Klammern sind hier reguläre Klammern und haben nichts mit Tupeln zu tun.
                            Der Ausdruck in den Klammern ist ein <em>Generatorausdruck</em>.
                        </li>
                        <li class="fragment">
                            Überall, wo "Iterierbares" (bisher Listen, Tupel, Mengen oder `range`) stehen kann, können auch Generatorausdrücke stehen:<br>
                            ```cols=30
                            sum(x*x for x in l if x > 1)
                            ```
                        </li>
                        <li class="fragment">
                            ```cols=40
                            for x in (x*x for x in l if x > 2):
                                print(x+5)
                            ```
                        </li>
                        <li class="fragment">
                            Ja, auch in Comprehensions/Generatorausdrücken:<br>
                            ```cols=45
                            [ x+5 for x in (x*x for x in l if x > 2) ]
                            ```
                        </li>
                    </ul>
                </section>

                <section class="center" style="text-align: center;">Platz für Fragen</section>

                <!-- SECTION: UEBERSICHT -->

                <section data-background-image="titleslide16-9.svg" data-background-size="contain" class="title">
                    <h3 style="margin-top: 200px">Übersicht</h3>
                </section>

                <section style="font-size: 35px">
                    <h1>Übersicht</h1>
                    <ul>
                        <li>Es folgt eine Übersicht über den Umgang mit Listen, Tupel, Mengen und Dictionaries.</li>
                        <li>Die Übersicht ist nicht für den Vortrag gedacht sondern zum Nachschlagen.</li>
                        <li>Die Übersicht ist nicht vollständig. Collections können viel.
                        <a href="https://python-reference.readthedocs.io/en/latest/basic_data_types.html">Python Reference (The Right Way)</a> ist z.B. sehr praktisch, falls sie tiefer gehen wollen.</li>
                        <li>Ausnahmen sind mit einem <i class="fa-solid fa-triangle-exclamation"></i> markiert.</li>
                        <li>Achten Sie eher auf Unterschiede als auf Gemeinsamkeiten, dann müssen Sie sich nicht viel merken.</li>
                        <li>Strings sind nicht separat aufgeführt. Stellen Sie sich Strings einfach als Tupel von Zeichen vor.</li>
                    </ul>
                </section>

                <section style="font-size: 27px">
                    <h1>Erstellen</h1>
                    <table>
                        <tr>
                            <td>leer</td>
                            <td>ein Element</td>
                            <td>mehrere Elemente</td>
                            <td>aus etwas "Iterierbarem"</td>
                        </tr>
                        <tr>
                            <td>```cols=8 br
                                l = []
                                l
                            ```</td>
                            <td>```cols=12 br
                                l = [ 1 ]
                                l
                            ```</td>
                            <td>```cols=16 br
                                l = [ 1, 2, 1 ]
                                l
                            ```</td>
                            <td>```cols=22 br
                                l = list(range(0, 5))
                                l
                            ```</td>
                        </tr>
                        <tr>
                            <td>```cols=8 br
                                t = ()
                                t
                            ```</td>
                            <td><i class="fa-solid fa-triangle-exclamation"></i> ```cols=10 br
                                t = ( 1, )
                                t
                            ```</td>
                            <td>```cols=16 br
                                t = ( 1, 2, 1 )
                                t
                            ```</td>
                            <td>```cols=22 br
                                t = tuple(range(0, 5))
                                t
                            ```</td>
                        </tr>
                        <tr>
                            <td><i class="fa-solid fa-triangle-exclamation"></i> ```cols=9 br
                                s = set()
                                s
                            ```</td>
                            <td>```cols=12 br
                                s = { 1 }
                                s
                            ```</td>
                            <td>```cols=16 br
                                s = { 1, 2, 1 }
                                s
                            ```</td>
                            <td>```cols=22 br
                                s = set(range(0, 5))
                                s
                            ```</td>
                        </tr>
                        <tr>
                            <td>```cols=8 br
                                d = {}
                                d
                            ```</td>
                            <td>```cols=12 br
                                d = {'a': 1}
                                d
                            ```</td>
                            <td>```cols=18 br
                                d = {'a':1, 'b':2}
                                d
                            ```</td>
                            <td><i class="fa-solid fa-triangle-exclamation"></i> ```cols=20 br
                                d = dict([('a', 1)])
                                d
                            ```<br>(Tupel von Schlüssel-Wert-Paaren)</td>
                    </table>
                </section>

                <section style="font-size: 30px">
                    <h1>Erstellen</h1>
                    <p-in cols=25>l = [ 3, 2, 4, 2, 1 ]</p-in><br><br>
                    <table cell-align:"left">
                        <tr>
                            <td></td>
                            <td>mit Comprehension</td>
                        </tr>
                        <tr>
                            <td>Liste</td>
                            <td>```cols=40 br
                                [ x*x for x in l if x > 1 ]
                            ```</td>
                        </tr>
                        <tr>
                            <td>Tupel</td>
                            <td><i class="fa-solid fa-triangle-exclamation"></i> ```cols=38 br
                                tuple(x*x for x in l if x > 1)
                            ```</td>
                        </tr>
                        <tr>
                            <td>Menge</td>
                            <td>```cols=40 br
                                { x*x for x in l if x > 1 }
                            ```</td>
                        </tr>
                        <tr>
                            <td>Dictionary</td>
                            <td>```cols=40 br
                                { x: x*x for x in l if x > 1 }
                            ```</td>
                        </tr>
                    </table>
                </section>

                <section style="font-size: 29px">
                    <h1>Erstellen</h1>
                    <table>
                        <tr>
                            <td></td>
                            <td>Zusammenfügen</td>
                            <td>Multiplizieren</td>
                        </tr>
                        <tr>
                            <td>```cols=19 br
                                l1 = [ 1, 2 ]
                                l1
                            ```</td>
                            <td>```cols=24 br
                                l2 = l1 + [ 2, 3 ]
                                l2
                            ```</td>
                            <td>```cols=15 br
                                l2 = l1 * 2
                                l2
                            ```</td>
                        </tr>
                        <tr>
                            <td>```cols=19 br
                                t1 = ( 1, 2 )
                                t1
                            ```</td>
                            <td>```cols=24 br
                                t2 = t1 + ( 2, 3 )
                                t2
                            ```</td>
                            <td>```cols=15 br
                                t2 = t1 * 2
                                t2
                            ```</td>
                        </tr>
                        <tr>
                            <td>```cols=19 br
                                s1 = { 1, 2 }
                                s1
                            ```</td>
                            <td><i class="fa-solid fa-triangle-exclamation"></i> ```cols=24 br
                                s2 = s1 | { 2, 3 }
                                s2
                            ```</td>
                            <td><i class="fa-solid fa-triangle-exclamation"></i> (ergibt keinen Sinn)
                            </td>
                        </tr>
                        <tr>
                            <td>```cols=19 br
                                d1 = {1:'a', 2:'b'}
                                d1
                            ```</td>
                            <td><i class="fa-solid fa-triangle-exclamation"></i> ```cols=24 br
                                d2 = d1 | {2:'c', 3:'d'}
                                d2
                            ```</td>
                            <td><i class="fa-solid fa-triangle-exclamation"></i> (ergibt keinen Sinn)
                            </td>
                    </table>
                </section>

                <section style="font-size: 28px">
                    <h1>Hinzufügen</h1>
                    <table>
                        <tr>
                            <td></td>
                            <td>einzeln</td>
                            <td>mehrere</td>
                        </tr>
                        <tr>
                            <td>```cols=19 br
                                l = [ 1, 2 ]
                                l
                            ```</td>
                            <td>```cols=12 br
                                l.append(2)
                                l
                            ```</td>
                            <td>```cols=25 br
                                l.extend([ 3, 4 ])
                                l
                            ```</td>
                        </tr>
                        <tr>
                            <td>```cols=19 br
                                t = ( 1, 2 )
                                t
                            ```</td>
                            <td><i class="fa-solid fa-triangle-exclamation"></i> (nicht erlaubt)</td>
                            <td><i class="fa-solid fa-triangle-exclamation"></i> (nicht erlaubt)</td>
                        </tr>
                        <tr>
                            <td>```cols=19 br
                                s = { 1, 2 }
                                s
                            ```</td>
                            <td>```cols=12 br
                                s.add(2)
                                s
                            ```</td>
                            <td>```cols=25 br
                                s.update({ 3, 4 })
                                s
                            ```</td>
                        </tr>
                        <tr>
                            <td>```cols=19 br
                                d = {1:'a', 2:'b'}
                                d
                            ```</td>
                            <td><i class="fa-solid fa-triangle-exclamation"></i> (nicht als Methode)</td>
                            <td>```cols=25 br
                                d.update({2:'c', 3:'d'})
                                d
                            ```</td>
                        </tr>
                    </table>
                </section>

                <section style="font-size: 26px;">
                    <h1>Subskript</h1>
                    <table>
                        <tr>
                            <td></td>
                            <td>einzeln</td>
                            <td>einzeln Zuweisen</td>
                            <td>Slice</td>
                            <td>Slice Zuweisen</td>
                        </tr>
                        <tr>
                            <td>```cols=16 br
                                l = [2, 4, 3, 1]
                                l
                            ```</td>
                            <td>```cols=6 br
                                l[1]
                            ```</td>
                            <td>```cols=14 br
                                l[1] = 4
                                l
                            ```</td>
                            <td>```cols=10 br
                                l[1:3]
                            ```</td>
                            <td>```cols=15 br
                                l[1:3] = [1, 5]
                                l
                            ```</td>
                        </tr>
                        <tr>
                            <td>```cols=16 br
                                t = (2, 4, 3, 1)
                                t
                            ```</td>
                            <td>```cols=6 br
                                t[1]
                            ```</td>
                            <td><i class="fa-solid fa-triangle-exclamation"></i> (nicht erlaubt)</td>
                            <td>```cols=10 br
                                t[1:3]
                            ```</td>
                            <td><i class="fa-solid fa-triangle-exclamation"></i> (nicht erlaubt)</td>
                        </tr>
                        <tr>
                            <td>```cols=16 br
                                s = {2, 4, 3, 1}
                                s
                            ```</td>
                            <td><i class="fa-solid fa-triangle-exclamation"></i> (ergibt keinen Sinn)</td>
                            <td><i class="fa-solid fa-triangle-exclamation"></i> (nicht erlaubt)</td>
                            <td><i class="fa-solid fa-triangle-exclamation"></i> (ergibt keinen Sinn)</td>
                            <td><i class="fa-solid fa-triangle-exclamation"></i> (nicht erlaubt)</td>
                        </tr>
                        <tr>
                            <td>```cols=18 br
                                d = {'a':1, 'b':4}
                                d
                            ```</td>
                            <td>```cols=6 br
                                d['a']
                            ```</td>
                            <td>```cols=14 br
                                d['a'] = 5
                                d
                            ```</td>
                            <td><i class="fa-solid fa-triangle-exclamation"></i> (ergibt keinen Sinn)</td>
                            <td><i class="fa-solid fa-triangle-exclamation"></i> (ergibt keinen Sinn)</td>
                        </tr>
                    </table>
                </section>

                <section style="font-size: 24px">
                    <h1>`in`</h1>
                    <table>
                        <tr>
                            <td></td>
                            <td>enthält</td>
                            <td>iterieren</td>
                        </tr>
                        <tr>
                            <td>```cols=16 br
                                l = [2, 4, 3]
                                l
                            ```</td>
                            <td>```cols=8 br
                                4 in l
                            ```</td>
                            <td>```cols=14
                                for x in l:
                                    print(x)
                            ```</td>
                        </tr>
                        <tr>
                            <td>```cols=16 br
                                t = (2, 4, 3)
                                t
                            ```</td>
                            <td>```cols=8 br
                                4 in t
                            ```</td>
                            <td>```cols=14
                                for x in t:
                                    print(x)
                            ```</td>
                        </tr>
                        <tr>
                            <td>```cols=16 br
                                s = {2, 4, 3}
                                s
                            ```</td>
                            <td>```cols=8 br
                                4 in s
                            ```</td>
                            <td>```cols=14
                                for x in s:
                                    print(x)
                            ```</td>
                        </tr>
                        <tr>
                            <td>```cols=18 br
                                d = {'a':1, 'b':4}
                                d
                            ```</td>
                            <td><i class="fa-solid fa-triangle-exclamation"></i> ```cols=8 br
                                'b' in d
                            ```</td>
                            <td><i class="fa-solid fa-triangle-exclamation"></i> ```cols=20
                                for k in d:
                                    print(k, d[k])
                            ```<br>
                            ```cols=25
                                for k, v in d.items():
                                    print(k, v)
                            ```</td>
                        </tr>
                    </table>
                </section>

                <section style="font-size: 22px">
                    <h1>Entfernen</h1>
                    <table>
                        <tr>
                            <td></td>
                            <td>vom Ende</td>
                            <td>mit Index/Schlüssel</td>
                            <td>mit Wert</td>
                        </tr>
                        <tr>
                            <td>```cols=16 br
                                l = [2, 4, 3, 1]
                                l
                            ```</td>
                            <td>```cols=18 br
                                print(l.pop())
                                l
                            ```</td>
                            <td>```cols=18 br
                                print(l.pop(1))
                                l
                            ```<br>Achtung: teuer!</td>
                            <td>```cols=18 br
                                l.remove(2)
                                l
                            ```<br>Achtung: teuer!</td>
                        </tr>
                        <tr>
                            <td>```cols=16 br
                                t = (2, 4, 3, 1)
                                t
                            ```</td>
                            <td><i class="fa-solid fa-triangle-exclamation"></i> (nicht erlaubt)</td>
                            <td><i class="fa-solid fa-triangle-exclamation"></i> (nicht erlaubt)</td>
                            <td><i class="fa-solid fa-triangle-exclamation"></i> (nicht erlaubt)</td>
                        </tr>
                        <tr>
                            <td>```cols=16 br
                                s = {2, 4, 3, 1}
                                s
                            ```</td>
                            <td><i class="fa-solid fa-triangle-exclamation"></i> ```cols=18 br
                                print(s.pop())
                                s
                            ```<br>Achtung: zufällig!</td>
                            <td><i class="fa-solid fa-triangle-exclamation"></i> (ergibt keinen Sinn)</td>
                            <td>```cols=18 br
                                s.remove(2)
                                s
                            ```</td>
                        </tr>
                        <tr>
                            <td>```cols=18 br
                                d = {'a':1, 'b':4}
                                d
                            ```</td>
                            <td><i class="fa-solid fa-triangle-exclamation"></i> ```cols=18 br
                                print(d.popitem())
                                d
                            ```<br>Achtung: zufällig!</td>
                            <td><i class="fa-solid fa-triangle-exclamation"></i> ```cols=17 br
                                print(d.pop('a'))
                                d
                            ```</td>
                            <td><i class="fa-solid fa-triangle-exclamation"></i> (nicht die Idee)</td>
                    </table>
                </section>

                <!-- SECTION: UEBUNG -->

                <section data-background-image="titleslide16-9.svg" data-background-size="contain" class="title">
                    <h3 style="margin-top: 200px">Übung</h3>
                </section>

            </div>

        </div>

        <script src="dist/reveal.js"></script>
        <script src="plugin/highlight/highlight.js"></script>
        <script src="highlighted-code.js"></script>
        <script>
            // <p-il> tag for quick inline Python highlighting
            class PythonInline extends HTMLElement {
                constructor() {
                    super();
                    this.go();
                }

                go() {
                    let code = this.code ? this.code : this.innerText
                    this.innerHTML = `<code class="language-python hljs">${RevealHighlight().hljs.highlight(code, { language: 'python' }).value}</code>`
                }
            }
            customElements.define("p-il", PythonInline);

            // <p-in> tag for quick python input
            class PythonInput extends HTMLElement {
                constructor() {
                    super();
                    this.go();
                }

                go() {
                    let code = this.code ? this.code : this.innerText
                    let ns = this.getAttribute("data-ns") !== null ? `data-ns="${this.getAttribute("data-ns")}"` : "data-ns"
                    if(this.getAttribute("hidden") !== null) {
                        this.innerHTML = `<textarea style="display: none" ${ns}>${code}</textarea>`
                    } else {
                        let autoHeight = this.getAttribute("auto-height") !== null ? "auto-height" : ""
                        let rows = this.getAttribute("rows") !== null ? `rows="${this.getAttribute("rows")}"` : `rows="${code.split('\n').length}"`
                        let cols = this.getAttribute("cols") !== null ? `cols="${this.getAttribute("cols")}"` : ""
                        this.innerHTML = `<textarea is="highlighted-code" language="python" tab-size="2" ${autoHeight} ${rows} ${cols} ${ns} spellcheck="false">${code}</textarea>`
                    }
                }
            }
            customElements.define("p-in", PythonInput);

            // <p-out> tag for quick python output
            class PythonOutput extends HTMLElement {
                constructor() {
                    super();
                }
            }
            customElements.define("p-out", PythonOutput);

            // <p-ex> tag for quick python example (combined input-output)
            // ``` is a shortcut for this tag. You can put attributes after, ex:
            // ```cols=15
            // print('123')
            // ```
            class PythonExample extends HTMLElement {
                constructor() {
                    super();
                    this.go();
                }

                go() {
                    let code = this.code ? this.code : this.innerText
                    let cols = this.getAttribute("cols") !== null ? `cols="${this.getAttribute("cols")}"` : ""
                    let ns = this.getAttribute("data-ns") !== null ? `data-ns="${this.getAttribute("data-ns")}"` : "data-ns"
                    let rows = `rows="${code.split('\n').length}"`
                    let br = this.getAttribute("br") !== null ? "<br>" : ""
                    this.innerHTML = `<textarea is="highlighted-code" language="python" tab-size="2" auto-height ${rows} ${cols} ${ns} spellcheck="false">${code}</textarea>`
                        + `${br}<p-out ${ns}></p-out>`
                }
            }
            customElements.define("p-ex", PythonExample);

            function replaceBackticks() {
                for (n of document.body.querySelectorAll(`section *`)) {
                    if (n.tagName == "TEXTAREA" || n.tagName.startsWith("P-")) {
                        continue
                    }
                    do {
                        replaced = false
                        for (e of n.childNodes) {
                            if (e.nodeType == Node.TEXT_NODE) {
                                if (replaceBackticksInText(e)) {
                                    n.removeChild(e)
                                    replaced = true
                                    break
                                }
                            }
                        }
                    } while(replaced)
                }
            }
            function replaceBackticksInText(textNode) {
                if (textNode.textContent.indexOf("`") < 0) {
                    return
                }
                let chunks = textNode.textContent.split("```");
                for (i in chunks) {
                    if (parseInt(i) % 2 == 0) {
                        replaceSingleBackticksInText(textNode, chunks[i])
                    } else {
                        let ex = new PythonExample()
                        let lines = chunks[i].trimEnd().split("\n")
                        attributes = lines[0].split(" ")
                        // if attributes contain hidden, do a p-in instead
                        if(attributes.includes("hidden")) {
                            ex = new PythonInput()
                        }
                        setAttributes(ex, lines[0])
                        let ws = lines[1].match(/^\s*/)[0]
                        // remove equal whitespace at the start of all lines
                        ex.code = lines.splice(1).map(l => l.replace(ws, "")).join("\n")
                        ex.go()
                        textNode.parentElement.insertBefore(ex, textNode)
                    }
                }
                return true
            }
            function replaceSingleBackticksInText(textNode, text) {
                let chunks = text.split("`");
                for (i in chunks) {
                    if (parseInt(i) % 2 == 0) {
                        textNode.parentElement.insertBefore(document.createTextNode(chunks[i]), textNode);
                    } else {
                        let ex = new PythonInline()
                        ex.code = chunks[i]
                        ex.go()
                        textNode.parentElement.insertBefore(ex, textNode)
                    }
                }
            }
            function setAttributes(elem, s) {
                if (!s.trim()) {
                    return
                }
                for (c of s.split(" ")) {
                    let p = c.split("=", 2)
                    elem.setAttribute(p[0], p[1])
                }
            }
            replaceBackticks()

            let out = [ ]
            let skipPython = false
            async function init() {
                if (skipPython) {
                    return
                }
                console.log('loading Pyodide')
                const { loadPyodide } = await import("https://cdn.jsdelivr.net/pyodide/v0.24.1/full/pyodide.mjs");
                let p = await loadPyodide({
                    stdout: x => out.push(x),
                    stderr: x => out.push(x)
                });

                console.log('importing repr_shorten')
                let namespace = p.globals.get("dict")();
                p.runPython('from pyodide.console import repr_shorten', { globals: namespace })
                return { p: p, repr_shorten: namespace.get("repr_shorten"), n: p.globals.get("dict")() }
            }
            let pyodide = init()

            function getParentSlide(elem) {
                while (elem && elem.tagName != "SECTION") {
                    elem = elem.parentElement
                }
                return elem
            }

            async function fillOutput(elem) {
                // we only take code on current slide
                slide = getParentSlide(elem)
                // namespace can be undefined or empty!
                let ns = elem.dataset.ns

                // we separate by outputs so that we can isolate the print/return for exactly the last box
                var code = [ [ ] ]
                if (ns == "test") {
                    code[0].push(
`def test_input_expected_pairs(pairs, function):
    function_name = repr(function).split(" ")[1]
    for *i, e in d:
        try:
            a = function(*i)
        except Exception as ex:
            print('Fehler beim Ausführen von')
            print(function_name, '(', sep="", end="")
            print(*[repr(x) for x in i], sep=", ", end=")\\n")
            raise ex
        if a != e:
            print(function_name, '(', sep="", end="")
            print(*[repr(x) for x in i], sep=", ", end=")\\n")
            print("Erwartet:", repr(e))
            print("Ist aber:", repr(a))
            return
    print('Sieht gut aus!')
    from pyodide.code import run_js
    run_js("report_current_exercise_complete()")`)
                }
                for(e of slide.querySelectorAll(`textarea, p-out`)) {
                    if (e == elem) {
                        break
                    }
                    // ignore namespace entirely if either element's namespace is empty or undefined
                    if ((ns || e.dataset.ns) && e.dataset.ns != ns) {
                        continue
                    }
                    if (e.tagName == "P-OUT") {
                        // introduce new code group to make sure that outputs are neatly separated
                        code.push([ ])
                    } else {
                        code.slice(-1)[0].push(c = e.value || e.innerText.trim() || e.innerHTML.trim())
                    }
                }
                // console.log('running code', code, 'in', ns)
                await runCode(code, elem)
            }

            async function runCode(code, elem) {
                // see here: https://github.com/pyodide/pyodide/blob/main/src/templates/console.html

                elem.innerText = "..."
                p = (await pyodide)
                p.n.clear() // clear the namespace
                var result = undefined
                let error = [ ]
                areas: for (cs of code) {
                    out.length = 0
                    for (c of cs) {
                        try {
                            result = p.p.runPython(c, { globals: p.n })
                        } catch (e) {
                            if (e.constructor.name === "PythonError") {
                                lines = e.message.trim().split('\n')
                                ours = 1
                                for(l in lines) {
                                    if(lines[l].startsWith('  File "<exec>", ')) {
                                        ours = l
                                        lines[l] = "  " + lines[l].substr(17);
                                    }
                                    if(lines[l].endsWith(', in <module>')) {
                                        lines[l] = lines[l].substr(0, lines[l].indexOf(', in <module>'));
                                    }
                                }
                                error.push(lines[0] + "\n" + lines.slice(ours).join("\n"));
                                break areas;
                            } else {
                                throw e;
                            }
                        }
                    }
                }

                elem.innerText = out.join("\n")
                html = elem.innerHTML
                if (error.length > 0) {
                    elem.innerText = error.join("\n")
                    elem.innerHTML = (html ? html + "<br>" : "") + `<span class="error">${elem.innerHTML}</code>`
                } else if (result !== undefined) {
                    elem.innerText = p.repr_shorten.callKwargs(result, {
                        separator: "\n<long output truncated>\n",
                    });
                    elem.innerHTML = (html ? html + "<br>" : "") + `<code class="language-python">${elem.innerHTML}</code>`
                }
                // console.log('result:', elem.innerHTML)

                elem.style.display = elem.innerHTML.indexOf("<br") >= 0 ? "inline-block" : "inline";

                if (Reveal.getPlugin && elem.lastChild && elem.lastChild.tagName == "CODE") {
                    // cheap way of preventing crashes before initialized
                    Reveal.getPlugin('highlight').highlightBlock(elem.lastChild)
                }
                if (Reveal.layout) {
                    // so that highlights move with their textareas
                    Reveal.dispatchEvent({type: 'resize', data: {}})
                }
            }

            async function runAllCode() {
                if (skipPython) {
                    return
                }
                for (const elem of document.querySelectorAll('p-out')) {
                    // put the little arrow before
                    a = document.createElement("a")
                    a.className = "runCode"
                    a.onclick = () => fillOutput(elem);
                    elem.parentElement.insertBefore(a, elem)
                    await fillOutput(elem)
                }
            }

            let allCodeInserted = pyodide.then(runAllCode).then(() => {
                console.log('initializing Reveal')
                let cbPath = 'https://cdn.jsdelivr.net/npm/reveal.js-plugins@4.2.5/chalkboard/'
                Reveal.initialize({
                    width: 1280,
                    height: 720,
                    margin: 0.07,

                    controls: new URLSearchParams(window.location.search).get('withControls') !== null,
                    progress: false,
                    center: false,
                    hash: true,
                    fragments: new URLSearchParams(window.location.search).get('noFragments') === null,
                    pdfSeparateFragments: false,
                    backgroundTransition: 'slide',
                    slideNumber: 'c',

                    // Learn about plugins: https://revealjs.com/plugins/
                    plugins: [ RevealHighlight, RevealChalkboard, RevealCustomControls ],

                    chalkboard: {
                        background: [ 'rgba(127,127,127,0)' , path + 'img/blackboard.png' ],
                        boardmarkers : [
                                { color: 'rgba(180,20,60,1)', cursor: 'url(' + cbPath + 'img/boardmarker-red.png), auto'},
                                { color: 'rgba(100,100,100,1)', cursor: 'url(' + cbPath + 'img/boardmarker-black.png), auto'},
                                { color: 'rgba(30,144,255, 1)', cursor: 'url(' + cbPath + 'img/boardmarker-blue.png), auto'},
                                { color: 'rgba(50,205,50,1)', cursor: 'url(' + cbPath + 'img/boardmarker-green.png), auto'},
                                { color: 'rgba(255,140,0,1)', cursor: 'url(' + cbPath + 'img/boardmarker-orange.png), auto'},
                                { color: 'rgba(150,0,20150,1)', cursor: 'url(' + cbPath + 'img/boardmarker-purple.png), auto'},
                                { color: 'rgba(255,220,0,1)', cursor: 'url(' + cbPath + 'img/boardmarker-yellow.png), auto'},
                        ],
                    },
                });

                var ready = false
                let autoscale = () => {
                    if (Reveal.isOverview()) {
                        return;
                    }
                    var scaled = false
                    if (document.querySelectorAll('section').length == 0) {
                        // this is for print stuff
                        return
                    }
                    const s = getComputedStyle(document.body).getPropertyValue('--slide-scale') || 1;
                    const h = parseInt(getComputedStyle(document.body).getPropertyValue('--slide-height')) * s
                    document.querySelectorAll('section[data-autoscale]').forEach(elem => {
                        if(elem.dataset.autoscale == "done" || elem.getBoundingClientRect().height == 0) {
                            return
                        }
                        if(elem.getBoundingClientRect().height > h) {
                            let fs = getComputedStyle(elem).fontSize
                            if (!fs.endsWith('px')) {
                                return;
                            }
                            elem.style.fontSize = (parseInt(fs) - 1) + 'px';
                            scaled = true
                        } else {
                            elem.dataset.autoscale = "done"
                        }
                    });
                    if (scaled) {
                        Reveal.dispatchEvent({type: 'resize', data: {}})
                    }
                }

                Reveal.on('ready', event => {
                    console.log('reveal.js ready')
                    document.querySelectorAll('p-out code').forEach(elem => {
                        Reveal.getPlugin('highlight').highlightBlock(elem)
                    });
                    autoscale()
                })

                Reveal.on('resize', event => {
                    console.log('reveal.js resize')
                    autoscale()
                })

                Reveal.on('slidechanged', event => {
                    let s = Reveal.getSlidePastCount() + 1
                    sendSlideChange(s)
                    autoscale()
                    Reveal.dispatchEvent({type: 'resize', data: {}})
                })

                Reveal.on('overviewshown', event => {
                    Reveal.dispatchEvent({type: 'resize', data: {}})
                })

                Reveal.on('overviewhidden', event => {
                    Reveal.dispatchEvent({type: 'resize', data: {}})
                })
            })

            function report_current_exercise_complete() {
                let s = Reveal.getSlidePastCount() + 1
                sendExerciseComplete(s)
            }
        </script>

    </body>
</html>
